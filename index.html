document.addEventListener("DOMContentLoaded", () => {
    const screen = document.getElementById("screen");
    let currentInput = "0";
    let operator = null;
    let firstOperand = null;

    // 🌙 A 페이지에서 저장한 다크 모드 설정 가져오기
    let darkMode = localStorage.getItem("darkMode");
    if (darkMode === "enabled") {
        document.body.classList.add("dark-mode");
    }

    // 버튼 클릭 이벤트
    document.querySelectorAll(".btn").forEach(button => {
        button.addEventListener("click", () => {
            const value = button.dataset.value;

            if (!isNaN(value) || value === ".") {
                handleNumber(value);
            } else if (value === "AC") {
                resetCalculator();
            } else if (value === "+/-") {
                toggleSign();
            } else if (value === "%") {
                applyPercentage();
            } else if (value === "=") {
                calculateResult();
            } else {
                handleOperator(value);
            }
            updateScreen();
        });
    });

    function handleNumber(value) {
        if (currentInput === "0" && value !== ".") {
            currentInput = value; // 첫 번째 숫자 입력시 "0" 대신 입력된 값으로 변경
        } else {
            currentInput += value; // 그 외 숫자는 기존 입력 뒤에 이어 붙이기
        }
    }

    function resetCalculator() {
        currentInput = "0";
        operator = null;
        firstOperand = null;
    }

    function toggleSign() {
        currentInput = (parseFloat(currentInput) * -1).toString();
    }

    function applyPercentage() {
        currentInput = (parseFloat(currentInput) / 100).toString();
    }

    function calculateResult() {
        if (firstOperand !== null && operator !== null) {
            switch (operator) {
                case "+":
                    currentInput = (firstOperand + parseFloat(currentInput)).toString();
                    break;
                case "-":
                    currentInput = (firstOperand - parseFloat(currentInput)).toString();
                    break;
                case "*":
                    currentInput = (firstOperand * parseFloat(currentInput)).toString();
                    break;
                case "/":
                    currentInput = (firstOperand / parseFloat(currentInput)).toString();
                    break;
            }
            operator = null;
            firstOperand = null;
        }
    }

    function handleOperator(value) {
        if (firstOperand === null) {
            firstOperand = parseFloat(currentInput);
        } else if (operator !== null) {
            calculateResult();
        }
        operator = value;
        currentInput = "0";
    }

    function updateScreen() {
        screen.textContent = currentInput;
    }
});
